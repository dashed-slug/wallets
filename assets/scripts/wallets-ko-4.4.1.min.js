!function(f){"use strict";f(function(){var l=3e4;moment.locale(f("html").attr("lang").toLowerCase().split("-")[0]);var i=function(e){"function"==typeof swal?swal(e):alert(e)},c=function(e,t,a){e.status&&403!=e.status&&(401==e.status?f(".dashed-slug-wallets").replaceWith('<div class="dashed-slug-wallets">'+e.responseJSON.message+"</div>"):i(sprintf(wallets_ko_i18n.contact_fail,t,a)))},d=function(e){void 0!==e.code&&-107==e.code||"string"==typeof e.result&&("error"==e.result?i(sprintf(wallets_ko_i18n.op_failed_msg,e.message)):i(wallets_ko_i18n.op_failed))};function t(){setTimeout(function(){"object"==typeof ko.tasks&&ko.tasks.runEarly(),f(".dashed-slug-wallets select.select2-hidden-accessible").each(function(e,t){f(t).data("select2")?f(t).select2("destroy"):f(t).removeClass("select2-hidden-accessible")}),f(".dashed-slug-wallets .select2").remove()},1e3)}var o=!1,s=!1,r=!1;"object"==typeof ko&&"object"==typeof ko.options&&(ko.options.deferUpdates=!0);var u=new function(){var i=this;i.ajaxSemaphore=ko.observable(0),i.selectedCoin=ko.observable(),i.selectedCryptoCoin=ko.observable(),i.selectedFiatCoin=ko.observable(),i.showZeroBalances=ko.observable(),i.coinsResponse={},i.coinsDirty=ko.observable(!0),i.coins=ko.computed(function(){return i.coinsDirty()&&f.ajax({url:walletsUserData.home_url,dataType:"json",cache:!0,async:!0,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"get_coins_info"},success:function(e){"success"==e.result?(i.coinsResponse=e.coins,i.coinsDirty(!1),o||(f("body").trigger("wallets_coins_ready",[e.coins]),o=!0),r||o&&s&&(f("body").trigger("wallets_ready",[i.coins(),i.nonces()]),r=!0)):d(e)},complete:function(){t()},error:c}),i.coinsResponse}),i.cryptoCoins=ko.computed(function(){var e=i.coins(),t={};for(var a in e)e[a].is_fiat||(t[a]=e[a]);return t}),i.fiatCoins=ko.computed(function(){var e=i.coins(),t={};for(var a in e)e[a].is_fiat&&(t[a]=e[a]);return t}),i.selectedCoin.subscribe(function(){"object"==typeof i.cryptoCoins()[i.selectedCoin()]&&i.selectedCryptoCoin(i.selectedCoin()),"object"==typeof i.fiatCoins()[i.selectedCoin()]&&i.selectedFiatCoin(i.selectedCoin())}),i.selectedFiatCoin.subscribe(function(){i.selectedCoin(i.selectedFiatCoin())}),i.selectedCryptoCoin.subscribe(function(){i.selectedCoin(i.selectedCryptoCoin())}),i.coins.subscribe(t),i.coins.subscribe(function(){i.selectedCoin()||f.isEmptyObject(i.coins())||i.selectedCoin(Object.keys(i.coins())[0])}),i.noncesResponse={},i.noncesDirty=ko.observable(!0),i.nonces=ko.computed(function(){return i.noncesDirty()&&f.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,async:!0,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"get_nonces"},success:function(e){"success"==e.result?(i.noncesResponse=e.nonces,i.noncesDirty(!1),s||(f("body").trigger("wallets_nonces_ready",[e.nonces]),s=!0),r||o&&s&&(f("body").trigger("wallets_ready",[i.coins(),i.nonces()]),r=!0)):d(e)},error:c}),i.noncesResponse}),i.accountValue=ko.computed(function(){var e=0,t=i.coins();for(var a in t){var o=t[a];e+=o.rate*o.balance}return sprintf(walletsUserData.fiatSymbol+" %01.2f",parseFloat(e))}),i.currentCoinBalance=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();return"object"==typeof e[t]?sprintf(e[t].sprintf,e[t].balance):""}),i.currentCoinFiatBalance=ko.computed(function(){if(walletsUserData.fiatSymbol){var e=i.coins(),t=i.selectedCoin();if("object"==typeof e[t]&&e[t].rate)return sprintf(walletsUserData.fiatSymbol+" %01.2f",e[t].balance*e[t].rate)}return""}),i.currentCoinAvailableBalance=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();return"object"==typeof e[t]?sprintf(e[t].sprintf,e[t].available_balance):""}),i.currentCoinFiatAvailableBalance=ko.computed(function(){if(walletsUserData.fiatSymbol){var e=i.coins(),t=i.selectedCoin();if("object"==typeof e[t]&&e[t].rate)return sprintf(walletsUserData.fiatSymbol+" %01.2f",e[t].available_balance*e[t].rate)}return""}),i.updateQrCode=function(){setTimeout(function(){if(void 0!==i.coins){var e=f(".dashed-slug-wallets.deposit:not(.static)");f(".qrcode",e).empty();var t=i.cryptoCoins(),a=i.selectedCryptoCoin();if("object"==typeof t[a]){var r=!1;"string"==typeof t[a].deposit_address_qrcode_uri?r=t[a].deposit_address_qrcode_uri:"string"==typeof t[a].deposit_address&&(r=t[a].deposit_address),r&&e.each(function(e,t){var a=f(t),o=f(".qrcode",a);if(o.length){var s=o.width();o.qrcode({width:s,height:s,text:r})}})}}},500)},"function"==typeof jQuery.fn.qrcode&&(i.coins.subscribe(i.updateQrCode),i.selectedCoin.subscribe(i.updateQrCode)),i.currentCoinDepositAddress=ko.computed(function(){var e=i.coins(),t=i.selectedCryptoCoin();return"object"==typeof e[t]?e[t].deposit_address:""}),i.currentCoinDepositExtra=ko.computed(function(){var e=i.coins(),t=i.selectedCryptoCoin();return"object"==typeof e[t]&&"string"==typeof e[t].deposit_extra?e[t].deposit_extra:""}),i.moveUser=ko.observable(),i.moveAmount=ko.observable().extend({validation:[{validator:function(e){return""===e||0<e},message:wallets_ko_i18n.amount_positive},{validator:function(e){if(""===e)return!0;var t=i.coins(),a=i.selectedCoin();if(a&&void 0!==t[a]){var o=parseFloat(t[a].move_fee);return o+=parseFloat(t[a].move_fee_proportional)*parseFloat(i.moveAmount()),isNaN(o)&&(o=0),0<parseFloat(e)-o}return!0},message:wallets_ko_i18n.amount_less_than_fee},{validator:function(e){if(""===e)return!0;var t=i.coins(),a=i.selectedCoin();if(a&&void 0!==t[a]){var o=parseFloat(t[a].move_fee);return o+=parseFloat(t[a].move_fee_proportional)*parseFloat(i.moveAmount()),isNaN(o)&&(o=0),t[a].available_balance>=parseFloat(e)&&parseFloat(e)>=o}return!0},message:wallets_ko_i18n.insufficient_balance}]}),i.moveFiatAmount=ko.computed(function(){var e=parseFloat(i.moveAmount());if(!isNaN(e)&&walletsUserData.fiatSymbol){var t=i.coins(),a=i.selectedCoin();if("object"==typeof t[a]&&t[a].rate)return sprintf(walletsUserData.fiatSymbol+" %01.2f",parseFloat(e)*t[a].rate)}return""}),i.moveComment=ko.observable(),i.moveFee=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();if("object"==typeof e[t]){var a=parseFloat(e[t].move_fee);if(a+=parseFloat(e[t].move_fee_proportional)*parseFloat(i.moveAmount()),!isNaN(a)){var o=sprintf(e[t].sprintf,a),s=sprintf(walletsUserData.fiatSymbol+" %01.2f",a*e[t].rate);return walletsUserData.fiatSymbol&&e[t].rate?[o,s]:[o,""]}}return["",""]}),i.moveAmountAfterFee=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();if("object"==typeof e[t]){var a=parseFloat(i.moveAmount());if(!isNaN(a)){var o=parseFloat(e[t].move_fee);if(o+=parseFloat(e[t].move_fee_proportional)*a,!isNaN(o)){var s=sprintf(e[t].sprintf,a-o),r=sprintf(walletsUserData.fiatSymbol+" %01.2f",(a-o)*e[t].rate);return walletsUserData.fiatSymbol&&e[t].rate?[s,r]:[s,""]}}}return["",""]}),i.doNewAddress=function(e){if(confirm(wallets_ko_i18n.get_new_address)){var t=i.selectedCoin(),a=i.nonces().do_new_address;i.ajaxSemaphore(i.ajaxSemaphore()+1),f.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"do_new_address",__wallets_symbol:t,_wpnonce:a},success:function(e){i.coinsDirty(!0)},complete:function(e,t){i.ajaxSemaphore(i.ajaxSemaphore()-1)},error:c})}},i.doMove=function(t){var a=i.moveUser(),o=i.moveAmount(),s=i.moveComment(),r=i.selectedCoin(),e=f("input[name=__wallets_move_tags]",t).val(),n=i.nonces().do_move;i.ajaxSemaphore(i.ajaxSemaphore()+1),f.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"do_move",__wallets_move_toaccount:a,__wallets_move_amount:o,__wallets_move_comment:s,__wallets_move_tags:e,__wallets_symbol:r,_wpnonce:n},success:function(e){f(t).trigger("wallets_do_move",[e,r,o,a,s]),i.coinsDirty(!0),i.transactionsDirty(!0)},complete:function(e,t){i.ajaxSemaphore(i.ajaxSemaphore()-1)},error:c})},i.getCoinIconUrl=function(e){if("string"==typeof e){var t=i.coins();if("string"==typeof t[e].icon_url)return t[e].icon_url}return""},i.resetMove=function(){i.moveAmount(""),i.moveComment(""),i.moveUser("")};var a=[];f.fn.walletsBindWithdrawAddressValidator=function(e,t){"string"==typeof e&&"function"==typeof t&&a.push({symbol:e,validatorFunction:t})},i.withdrawAddress=ko.observable().extend({validation:[{validator:function(e){for(var t in a)if(i.selectedCoin()==a[t].symbol&&"function"==typeof a[t].validatorFunction&&!a[t].validatorFunction(e))return!1;return!0},message:wallets_ko_i18n.invalid_add}]}),i.withdrawAmount=ko.observable().extend({validation:[{validator:function(e){return""===e||0<e},message:wallets_ko_i18n.amount_positive},{validator:function(e){if(""===e)return!0;var t=i.coins(),a=i.selectedCryptoCoin();if(a&&void 0!==t[a]){var o=parseFloat(t[a].withdraw_fee);return o+=parseFloat(t[a].withdraw_fee_proportional)*parseFloat(i.withdrawAmount()),isNaN(o)&&(o=0),0<parseFloat(e)-o}return!0},message:wallets_ko_i18n.amount_less_than_fee},{validator:function(e){if(""===e)return!0;var t=i.coins(),a=i.selectedCryptoCoin();return!a||void 0===t[a]||t[a].min_withdraw<=parseFloat(e)},message:wallets_ko_i18n.minimum_withdraw},{validator:function(e){if(""===e)return!0;var t=i.coins(),a=i.selectedCryptoCoin();if(a&&void 0!==t[a]){var o=parseFloat(t[a].withdraw_fee);return o+=parseFloat(t[a].withdraw_fee_proportional)*parseFloat(i.withdrawAmount()),isNaN(o)&&(o=0),t[a].available_balance>=parseFloat(e)&&parseFloat(e)>=o}return!0},message:wallets_ko_i18n.insufficient_balance}]}),i.withdrawFiatAmount=ko.computed(function(){var e=parseFloat(i.withdrawAmount());if(!isNaN(e)&&walletsUserData.fiatSymbol){var t=i.coins(),a=i.selectedCryptoCoin();if("object"==typeof t[a]&&t[a].rate)return sprintf(walletsUserData.fiatSymbol+" %01.2f",parseFloat(i.withdrawAmount())*t[a].rate)}return""}),i.withdrawComment=ko.observable(),i.withdrawExtra=ko.observable(),i.withdrawExtraDesc=ko.computed(function(){var e=i.coins(),t=i.selectedCryptoCoin();return"object"==typeof e[t]&&e[t].extra_desc}),i.withdrawFee=ko.computed(function(){var e=i.coins(),t=i.selectedCryptoCoin();if("object"==typeof e[t]){var a=parseFloat(e[t].withdraw_fee);if(a+=parseFloat(e[t].withdraw_fee_proportional)*parseFloat(i.withdrawAmount()),!isNaN(a)){var o=sprintf(e[t].sprintf,a),s=sprintf(walletsUserData.fiatSymbol+" %01.2f",a*e[t].rate);return walletsUserData.fiatSymbol&&e[t].rate?[o,s]:[o,""]}}return["",""]}),i.withdrawAmountAfterFee=ko.computed(function(){var e=i.coins(),t=i.selectedCryptoCoin();if("object"==typeof e[t]){var a=parseFloat(i.withdrawAmount());if(!isNaN(a)){var o=parseFloat(e[t].withdraw_fee);if(o+=parseFloat(e[t].withdraw_fee_proportional)*a,!isNaN(o)){var s=sprintf(e[t].sprintf,a-o),r=sprintf(walletsUserData.fiatSymbol+" %01.2f",(a-o)*e[t].rate);return walletsUserData.fiatSymbol&&e[t].rate?[s,r]:[s,""]}}}return["",""]}),i.doWithdraw=function(t){var a=i.withdrawAddress(),o=i.selectedCryptoCoin(),s=i.withdrawAmount(),r=i.withdrawComment(),n=i.withdrawExtra(),e=i.nonces().do_withdraw;i.ajaxSemaphore(i.ajaxSemaphore()+1),f.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"do_withdraw",__wallets_withdraw_address:a,__wallets_symbol:o,__wallets_withdraw_amount:s,__wallets_withdraw_comment:r,__wallets_withdraw_extra:n,_wpnonce:e},success:function(e){f(t).trigger("wallets_do_withdraw",[e,o,s,a,r,n]),i.coinsDirty(!1),i.transactionsDirty(!1),i.coinsDirty(!0),i.transactionsDirty(!0)},complete:function(e,t){i.ajaxSemaphore(i.ajaxSemaphore()-1)},error:c})},i.resetWithdraw=function(){i.withdrawAddress(""),i.withdrawAmount(""),i.withdrawComment(""),i.withdrawExtra("")},i.doResetApikey=function(){confirm(wallets_ko_i18n.apikey_renew_confirm)&&(i.ajaxSemaphore(i.ajaxSemaphore()+1),f.ajax({url:"object"==typeof walletsUserData?walletsUserData.home_url:null,dataType:"json",cache:!1,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"do_reset_apikey"},success:function(e){"success"==e.result&&(i.noncesDirty(!1),ko.tasks.runEarly(),i.noncesDirty(!0))},complete:function(e,t){i.ajaxSemaphore(i.ajaxSemaphore()-1)},error:c}))},i.currentPage=ko.observable(1).extend({rateLimit:500}),i.currentPage.subscribe(function(){i.transactionsDirty(!1),"object"==typeof ko.tasks&&ko.tasks.runEarly(),i.transactionsDirty(!0)}),i.rowsPerPage=ko.observable(10).extend({rateLimit:500}),i.rowsPerPage.subscribe(function(){i.transactionsDirty(!1),"object"==typeof ko.tasks&&ko.tasks.runEarly(),i.transactionsDirty(!0)}),i.transactionsResponse=[],i.transactionsDirty=ko.observable(!0),i.selectedCoin.subscribe(function(){i.transactionsDirty(!1),"object"==typeof ko.tasks&&ko.tasks.runEarly(),i.transactionsDirty(!0)}),i.transactions=ko.computed(function(){if(i.transactionsDirty()){var n=parseInt(i.currentPage()),e=i.rowsPerPage(),t=(n-1)*e,a=i.selectedCoin();"string"==typeof a&&a&&!isNaN(t)&&f.ajax({url:walletsUserData.home_url,dataType:"json",cache:!0,async:!0,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"get_transactions",__wallets_tx_count:e,__wallets_tx_from:t,__wallets_symbol:a},success:function(e){var t=[];if("success"==e.result){if(!e.transactions.length&&1<n)i.currentPage(n-1);else{t=e.transactions;var a=i.coins(),o=walletsUserData.fiatSymbol+" %01.2f";for(var s in t){t[s].tx_uri="",t[s].address_uri="";var r=t[s].symbol;"object"==typeof a[r]&&("string"!=typeof t[s].amount_string&&(t[s].amount_string=sprintf(a[r].sprintf,t[s].amount)),"string"!=typeof t[s].fee_string&&(t[s].fee_string=sprintf(a[r].sprintf,t[s].fee)),walletsUserData.fiatSymbol&&a[r].rate?(t[s].amount_fiat=sprintf(o,t[s].amount*a[r].rate),t[s].fee_fiat=sprintf(o,t[s].fee*a[r].rate)):t[s].amount_fiat=t[s].fee_fiat="","string"==typeof t[s].txid&&t[s].txid.match(/^[\w\d]+$/)&&(t[s].tx_uri=sprintf(a[r].explorer_uri_tx,t[s].txid)),"string"==typeof t[s].address&&t[s].address.match(/^[\w\d]+$/)&&(t[s].address_uri=sprintf(a[r].explorer_uri_address,t[s].address)))}}i.transactionsResponse=t,i.transactionsDirty(!1)}else d(e)},error:c})}return i.transactionsResponse})};"undefined"==typeof wp&&(window.wp={}),void 0===wp.wallets&&(window.wp.wallets={}),void 0===wp.wallets.viewModels&&(window.wp.wallets.viewModels={}),wp.wallets.viewModels.wallets=u,f(".dashed-slug-wallets").filter(".deposit,.withdraw,.move,.balance,.transactions,.account-value,.rates,.api-key").each(function(e,t){ko.applyBindings(u,t)}),f("html").on("wallets_do_move wallets_do_withdraw",function(e,t){"success"!=t.result?(d(t),e.preventDefault()):u.currentPage(u.currentPage())}),f("html").on("wallets_do_move",function(e,t,a,o,s,r){"success"==t.result&&(u.resetMove(),i(sprintf(wallets_ko_i18n.submit_tx,o,a)))}),f("html").on("wallets_do_withdraw",function(e,t,a,o,s,r,n){"success"==t.result&&(u.resetWithdraw(),i(sprintf(wallets_ko_i18n.submit_wd,o,a,s)))}),f("html").on("wallets_coins_ready",function(e,t){if("string"==typeof walletsUserData.defaultCoin){var a=walletsUserData.defaultCoin;t&&a&&"object"==typeof t[a]&&u.selectedCoin(a)}}),f("html").on("wallets_ready",function(e,t,a){f(".dashed-slug-wallets.deposit.static").each(function(e,t){var a=f(t),o=f(".qrcode",a);if(o.length){var s=o.width(),r=o.attr("data-qrcode-uri");r&&o.qrcode({width:s,height:s,text:r})}})}),setTimeout(function(){t(),u.noncesDirty(!0),setInterval(function(){u.noncesDirty(!1),u.noncesDirty(!0)},432e5),u.coinsDirty(!0);var e=parseFloat(walletsUserData.pollIntervalCoinInfo);e&&setInterval(function(){void 0!==window.document.hidden&&window.document.hidden||(u.coinsDirty(!1),"object"==typeof ko.tasks&&ko.tasks.runEarly(),u.coinsDirty(!0))},60*e*1e3)},1e3),setTimeout(function(){u.transactionsDirty(!1),"object"==typeof ko.tasks&&ko.tasks.runEarly(),u.transactionsDirty(!0);var e=parseFloat(walletsUserData.pollIntervalTransactions);e&&setInterval(function(){void 0!==window.document.hidden&&window.document.hidden||(u.transactionsDirty(!1),"object"==typeof ko.tasks&&ko.tasks.runEarly(),u.transactionsDirty(!0))},60*e*1e3)},2e3),parseInt(walletsUserData.walletsVisibilityCheckEnabled)&&window.document.addEventListener("visibilitychange",function(){window.document.hidden||(u.coinsDirty(!1),"object"==typeof ko.tasks&&ko.tasks.runEarly(),u.coinsDirty(!0))})})}(jQuery);
//# sourceMappingURL=wallets-ko-4.4.1.min.js.map